/* 
 * angular-disqus 1.1.0
 * http://github.com/kirstein/angular-disqus
 * 
 * Licensed under the MIT license
 */
!function(a,b){"use strict";var c=a.module("ngDisqus",[]);c.provider("$disqus",function(){function c(){return document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]}function d(){return o||b.disqus_shortname}function e(a,b){return"//"+a+".disqus.com/"+b}function f(a){var b=document.createElement("script");return b.type="text/javascript",b.async=!0,b.src=a,b}function g(a){var b=document.createElement("script");return b.type="text/javascript",b.text=a,b}function h(a,b){var c,d,e=a.getElementsByTagName("script");for(d=0;d<e.length;d+=1)if(c=e[d],~c.src.indexOf(b))return!0;return!1}function i(a,c,d){b.disqus_identifier=a,b.disqus_url=c,b.disqus_shortname=d}function j(){var c=b.DISQUSWIDGETS;c&&a.isFunction(c.getCount)&&c.getCount()}function k(a){return'var disqus_config = function () {\n  this.page.remote_auth_s3 = "'+a.auth+'";\n  this.page.api_key = "'+a.api_key+'";\n}'}function l(a,c){b.DISQUS.reset({reload:!0,config:function(){this.page.identifier=c,this.page.url=a.absUrl()}})}function m(a,b){var d=c(),g=e(a,b);h(d,g)||d.appendChild(f(g))}function n(a){var b=c(),d=k(a);b.appendChild(g(d))}var o,p="embed.js",q="count.js",r=!1;this.setShortname=function(a){o=a},this.enableSSO=function(){r=!0},this.$get=["$rootScope","$location","$http",function(c,e,f){function g(f){var g=d();if(!a.isDefined(g))throw new Error("No disqus shortname defined");if(!a.isDefined(f))throw new Error("No disqus thread id defined");a.isDefined(b.DISQUS)?l(e,f):(i(f,e.absUrl(),g),r?c.$on("disqus:sso:ready",function(){m(g,p)}):m(g,p))}function h(a){f.get(a).success(function(a){n(a),c.$emit("disqus:sso:ready")})}function k(a){i(a,e.absUrl(),o),m(d(),p),m(d(),q),j()}return{commit:g,getShortname:d,loadCount:k,configSSO:h}}]}),c.directive("disqus",["$disqus",function(b){return{restrict:"AC",replace:!0,scope:{id:"=disqus"},template:'<div id="disqus_thread"></div>',link:function(c){c.$watch("id",function(c){a.isDefined(c)&&b.commit(c)})}}}]),c.directive("disqusIdentifier",["$disqus",function(a){return{restrict:"A",link:function(b,c,d){a.loadCount(d.disqusIdentifier)}}}]),c.directive("disqusSsoUri",["$disqus",function(a){return{restrict:"A",link:function(b,c,d){a.configSSO(d.disqusSsoUri)}}}])}(angular,this);